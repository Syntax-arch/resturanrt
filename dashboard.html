<!DOCTYPE html>
<html lang="ja">
<head>
  
  <meta charset="UTF-8">
  <title>ダッシュボード - レストラン予約システム</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="style.css" rel="stylesheet">
  <style>
    .stats-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 15px;
      padding: 2rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    }
    .quick-action {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      transition: transform 0.3s ease;
      border: 1px solid rgba(0,0,0,0.1);
    }
    .quick-action:hover {
      transform: translateY(-5px);
    }
    .welcome-section {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      border-radius: 15px;
      padding: 2rem;
      margin-bottom: 2rem;
    }
    .recent-reservations {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <div class="sakura-decoration"></div>
  
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #c62828;">
    <div class="container">
      <a class="navbar-brand fw-bold" href="dashboard.html">
        🍣 レストラン予約システム
      </a>
      <div class="navbar-nav ms-auto">
        <span class="navbar-text me-3" id="userWelcome">
          ようこそ！
        </span>
        <button class="btn btn-outline-light btn-sm" id="logoutBtn">
          ログアウト
        </button>
      </div>
    </div>
  </nav>

  <div class="container mt-4">
    <!-- Welcome Section -->
    <div class="welcome-section">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h1 id="welcomeMessage">ようこそ！</h1>
          <p class="mb-0">レストラン予約システムへようこそ。予約の管理や新規予約を作成できます。</p>
        </div>
        <div class="col-md-4 text-end">
          <div class="display-4">🎉</div>
        </div>
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="row">
      <div class="col-md-4">
        <div class="stats-card text-center">
          <div class="display-4 mb-2" id="totalReservations">0</div>
          <div class="h5">総予約数</div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="stats-card text-center" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
          <div class="display-4 mb-2" id="upcomingReservations">0</div>
          <div class="h5">今後の予約</div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="stats-card text-center" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
          <div class="display-4 mb-2" id="todayReservations">0</div>
          <div class="h5">今日の予約</div>
        </div>
      </div>
    </div>

        <!-- Quick Actions - Row 1: Core Features -->
    <div class="row mb-4">
      <div class="col-12">
        <h4 class="mb-3">📊 メイン機能</h4>
      </div>
      <div class="col-md-3 mb-3">
        <a href="reservation.html" class="text-decoration-none">
          <div class="quick-action">
            <div class="h1 mb-3">📅</div>
            <h5>新規予約</h5>
            <p class="text-muted small">新しい予約を作成</p>
          </div>
        </a>
      </div>
      <div class="col-md-3 mb-3">
        <a href="reservation.html" class="text-decoration-none">
          <div class="quick-action">
            <div class="h1 mb-3">📋</div>
            <h5>予約一覧</h5>
            <p class="text-muted small">すべての予約を表示</p>
          </div>
        </a>
      </div>
      <div class="col-md-3 mb-3">
        <a href="menu.html" class="text-decoration-none">
          <div class="quick-action">
            <div class="h1 mb-3">🍽️</div>
            <h5>メニュー</h5>
            <p class="text-muted small">料理メニューを見る</p>
          </div>
        </a>
      </div>
      <div class="col-md-3 mb-3">
        <a href="profile.html" class="text-decoration-none">
          <div class="quick-action">
            <div class="h1 mb-3">👤</div>
            <h5>プロフィール</h5>
            <p class="text-muted small">アカウント情報</p>
          </div>
        </a>
      </div>
    </div>

    <!-- Quick Actions - Row 2: Restaurant Info -->
    <div class="row mb-4">
      <div class="col-12">
        <h4 class="mb-3">🏮 レストラン情報</h4>
      </div>
      <div class="col-md-3 mb-3">
        <a href="gallery.html" class="text-decoration-none">
          <div class="quick-action">
            <div class="h1 mb-3">🖼️</div>
            <h5>ギャラリー</h5>
            <p class="text-muted small">店内写真</p>
          </div>
        </a>
      </div>
      <div class="col-md-3 mb-3">
        <a href="info.html" class="text-decoration-none">
          <div class="quick-action">
            <div class="h1 mb-3">🏮</div>
            <h5>店舗情報</h5>
            <p class="text-muted small">レストラン詳細</p>
          </div>
        </a>
      </div>
      <div class="col-md-3 mb-3">
        <a href="events.html" class="text-decoration-none">
          <div class="quick-action">
            <div class="h1 mb-3">🎉</div>
            <h5>イベント</h5>
            <p class="text-muted small">特別イベント情報</p>
          </div>
        </a>
      </div>
      <div class="col-md-3 mb-3">
        <a href="private.html" class="text-decoration-none">
          <div class="quick-action">
            <div class="h1 mb-3">💼</div>
            <h5>貸切・個室</h5>
            <p class="text-muted small">プライベートダイニング</p>
          </div>
        </a>
      </div>
    </div>

    <!-- Quick Actions - Row 3: Customer Experience -->
    <div class="row mb-4">
      <div class="col-12">
        <h4 class="mb-3">⭐ カスタマーサービス</h4>
      </div>
      <div class="col-md-3 mb-3">
        <a href="reviews.html" class="text-decoration-none">
          <div class="quick-action">
            <div class="h1 mb-3">⭐</div>
            <h5>お客様の声</h5>
            <p class="text-muted small">レビューを見る</p>
          </div>
        </a>
      </div>
      <div class="col-md-3 mb-3">
        <a href="loyalty.html" class="text-decoration-none">
          <div class="quick-action">
            <div class="h1 mb-3">🎁</div>
            <h5>会員特典</h5>
            <p class="text-muted small">ロイヤルティプログラム</p>
          </div>
        </a>
      </div>
      <div class="col-md-3 mb-3">
        <a href="contact.html" class="text-decoration-none">
          <div class="quick-action">
            <div class="h1 mb-3">📞</div>
            <h5>お問い合わせ</h5>
            <p class="text-muted small">ご連絡はこちら</p>
          </div>
        </a>
      </div>
      <div class="col-md-3 mb-3">
        <a href="help.html" class="text-decoration-none">
          <div class="quick-action">
            <div class="h1 mb-3">❓</div>
            <h5>ヘルプ</h5>
            <p class="text-muted small">使い方ガイド</p>
          </div>
        </a>
      </div>
    </div>

    <!-- Quick Actions - Row 4: Additional -->
    <div class="row mb-4">
      <div class="col-12">
        <h4 class="mb-3">🔧 その他</h4>
      </div>
      <div class="col-md-3 mb-3">
        <a href="careers.html" class="text-decoration-none">
          <div class="quick-action">
            <div class="h1 mb-3">💼</div>
            <h5>採用情報</h5>
            <p class="text-muted small">キャリア opportunities</p>
          </div>
        </a>
      </div>
      <div class="col-md-3 mb-3">
        <div class="quick-action" style="cursor: not-allowed; opacity: 0.6;">
          <div class="h1 mb-3">📱</div>
          <h5>モバイルアプリ</h5>
          <p class="text-muted small">近日公開</p>
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <div class="quick-action" style="cursor: not-allowed; opacity: 0.6;">
          <div class="h1 mb-3">🎫</div>
          <h5>ギフトカード</h5>
          <p class="text-muted small">近日公開</p>
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <div class="quick-action" style="cursor: not-allowed; opacity: 0.6;">
          <div class="h1 mb-3">🚚</div>
          <h5>ケータリング</h5>
          <p class="text-muted small">近日公開</p>
        </div>
      </div>
    </div>

<!-- Additional Actions -->
<div class="row mb-4">
  <div class="col-md-3 mb-3">
    <a href="menu.html" class="text-decoration-none">
      <div class="quick-action">
        <div class="h1 mb-3">🍽️</div>
        <h5>メニュー</h5>
        <p class="text-muted small">料理メニューを見る</p>
      </div>
    </a>
  </div>
  <div class="col-md-3 mb-3">
    <a href="info.html" class="text-decoration-none">
      <div class="quick-action">
        <div class="h1 mb-3">🏮</div>
        <h5>店舗情報</h5>
        <p class="text-muted small">レストラン詳細</p>
      </div>
    </a>
  </div>
  <div class="col-md-3 mb-3">
    <a href="gallery.html" class="text-decoration-none">
      <div class="quick-action">
        <div class="h1 mb-3">🖼️</div>
        <h5>ギャラリー</h5>
        <p class="text-muted small">店内写真</p>
      </div>
    </a>
  </div>
  <div class="col-md-3 mb-3">
    <a href="contact.html" class="text-decoration-none">
      <div class="quick-action">
        <div class="h1 mb-3">📞</div>
        <h5>お問い合わせ</h5>
        <p class="text-muted small">ご連絡はこちら</p>
      </div>
    </a>
  </div>
  <!-- In the "その他" section of dashboard.html -->
<div class="row mb-4">
  <div class="col-12">
    <h4 class="mb-3">🔧 その他</h4>
  </div>
  <div class="col-md-3 mb-3">
    <a href="careers.html" class="text-decoration-none">
      <div class="quick-action">
        <div class="h1 mb-3">💼</div>
        <h5>採用情報</h5>
        <p class="text-muted small">キャリア opportunities</p>
      </div>
    </a>
  </div>
  <div class="col-md-3 mb-3">
    <a href="app.html" class="text-decoration-none">
      <div class="quick-action">
        <div class="h1 mb-3">📱</div>
        <h5>モバイルアプリ</h5>
        <p class="text-muted small">ダウンロード</p>
      </div>
    </a>
  </div>
  <div class="col-md-3 mb-3">
    <a href="giftcards.html" class="text-decoration-none">
      <div class="quick-action">
        <div class="h1 mb-3">🎫</div>
        <h5>ギフトカード</h5>
        <p class="text-muted small">購入・贈答</p>
      </div>
    </a>
  </div>
  <div class="col-md-3 mb-3">
    <a href="catering.html" class="text-decoration-none">
      <div class="quick-action">
        <div class="h1 mb-3">🚚</div>
        <h5>ケータリング</h5>
        <p class="text-muted small">出張料理サービス</p>
      </div>
    </a>
  </div>
</div>
</div>
    </a>
  </div>
</div>
    <!-- Recent Reservations -->
    <div class="recent-reservations">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h4>最近の予約</h4>
        <a href="reservation.html" class="btn btn-japanese btn-sm">すべて表示</a>
      </div>
      <div id="recentReservationsList">
        <div class="text-center py-4">
          <div class="text-muted">予約がありません</div>
          <a href="reservation.html" class="btn btn-japanese mt-2">最初の予約を作成</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Profile Modal -->
  <div class="modal fade" id="profileModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">プロフィール情報</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <strong>名前:</strong> <span id="profileName">-</span>
          </div>
          <div class="mb-3">
            <strong>メールアドレス:</strong> <span id="profileEmail">-</span>
          </div>
          <div class="mb-3">
            <strong>登録日:</strong> <span id="profileCreatedAt">-</span>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">閉じる</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
   
const currentUser = JSON.parse(localStorage.getItem('user'));
if (!currentUser) {
  alert('ログインが必要です');
  window.location.href = 'login.html';
}

    // Supabase configuration
    const SUPABASE_URL = 'https://nfcjbjohxzaikelxgmjg.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5mY2piam9oeHphaWtlbHhnbWpnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEwNTgzMjAsImV4cCI6MjA3NjYzNDMyMH0.u0ta1NxSDbJ_9lf1TcMp3M0-_vNNBs6HByOj8wtKsX4';
    
    // Initialize Supabase
    const { createClient } = supabase;
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    console.log('Dashboard loaded for user:', user);

    // Update welcome message
    document.getElementById('userWelcome').textContent = `ようこそ、${user.name}さん！`;
    document.getElementById('welcomeMessage').textContent = `ようこそ、${user.name}さん！`;
    
    // Set profile information
    document.getElementById('profileName').textContent = user.name;
    document.getElementById('profileEmail').textContent = user.email;
    if (user.created_at) {
      document.getElementById('profileCreatedAt').textContent = new Date(user.created_at).toLocaleDateString('ja-JP');
    } else {
      document.getElementById('profileCreatedAt').textContent = '今日';
    }

    // Load dashboard data
    async function loadDashboardData() {
      try {
        console.log('Loading reservations for user:', user.id);
        
        // Load user's reservations
        const { data: reservations, error } = await supabaseClient
          .from('reservations')
          .select('*')
          .eq('user_id', user.id)
          .order('created_at', { ascending: false });

        if (error) {
          console.error('Supabase error:', error);
          throw error;
        }

        console.log('Reservations loaded:', reservations);

        // Update stats
        const total = reservations ? reservations.length : 0;
        document.getElementById('totalReservations').textContent = total;
        
        const today = new Date().toISOString().split('T')[0];
        const upcoming = reservations ? reservations.filter(r => r.date >= today).length : 0;
        const todayCount = reservations ? reservations.filter(r => r.date === today).length : 0;
        
        document.getElementById('upcomingReservations').textContent = upcoming;
        document.getElementById('todayReservations').textContent = todayCount;

        // Show recent reservations (last 3)
        if (reservations && reservations.length > 0) {
          const recentReservations = reservations.slice(0, 3);
          displayRecentReservations(recentReservations);
        }

      } catch (error) {
        console.error('Error loading dashboard data:', error);
        // Show error but don't break the page
        document.getElementById('recentReservationsList').innerHTML = `
          <div class="alert alert-warning">
            データの読み込み中にエラーが発生しました
          </div>
        `;
      }
    }

    function displayRecentReservations(reservations) {
      const container = document.getElementById('recentReservationsList');
      
      let html = '';
      reservations.forEach(reservation => {
        const reservationDate = new Date(reservation.date + 'T' + reservation.time).toLocaleDateString('ja-JP', {
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });
        
        html += `
          <div class="reservation-item border-bottom pb-3 mb-3">
            <div class="row align-items-center">
              <div class="col-md-4">
                <strong>${reservation.customer_name}</strong>
              </div>
              <div class="col-md-3">
                ${reservationDate}
              </div>
              <div class="col-md-2">
                ${reservation.time}
              </div>
              <div class="col-md-2">
                ${reservation.guests}人
              </div>
              <div class="col-md-1">
                <span class="badge bg-success">確認済み</span>
              </div>
            </div>
          </div>
        `;
      });

      container.innerHTML = html;
    }

    // Logout function
    document.getElementById('logoutBtn').addEventListener('click', () => {
      if (confirm('ログアウトしますか？')) {
        localStorage.removeItem('user');
        window.location.href = 'index.html';
      }
    });

    // Help function
    function showHelp() {
      alert('お問い合わせ: support@restaurant.com\n電話: 0120-123-456\n\n使い方:\n1. 「新規予約」で予約を作成\n2. 「予約一覧」で管理\n3. プロフィールで情報確認');
    }

    // Load data when page loads
    document.addEventListener('DOMContentLoaded', function() {
      loadDashboardData();
    });
  </script>
</body>
</html>