<!DOCTYPE html>
<html lang="ja">
<head>
  
  <meta charset="UTF-8">
  <title>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ - ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³äºˆç´„ã‚·ã‚¹ãƒ†ãƒ </title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="style.css" rel="stylesheet">
  <style>
    .stats-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 15px;
      padding: 2rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    }
    .quick-action {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      transition: transform 0.3s ease;
      border: 1px solid rgba(0,0,0,0.1);
    }
    .quick-action:hover {
      transform: translateY(-5px);
    }
    .welcome-section {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      border-radius: 15px;
      padding: 2rem;
      margin-bottom: 2rem;
    }
    .recent-reservations {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <div class="sakura-decoration"></div>
  
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #c62828;">
    <div class="container">
      <a class="navbar-brand fw-bold" href="dashboard.html">
        ğŸ£ ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³äºˆç´„ã‚·ã‚¹ãƒ†ãƒ 
      </a>
      <div class="navbar-nav ms-auto">
        <span class="navbar-text me-3" id="userWelcome">
          ã‚ˆã†ã“ãï¼
        </span>
        <button class="btn btn-outline-light btn-sm" id="logoutBtn">
          ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
        </button>
      </div>
    </div>
  </nav>

  <div class="container mt-4">
    <!-- Welcome Section -->
    <div class="welcome-section">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h1 id="welcomeMessage">ã‚ˆã†ã“ãï¼</h1>
          <p class="mb-0">ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³äºˆç´„ã‚·ã‚¹ãƒ†ãƒ ã¸ã‚ˆã†ã“ãã€‚äºˆç´„ã®ç®¡ç†ã‚„æ–°è¦äºˆç´„ã‚’ä½œæˆã§ãã¾ã™ã€‚</p>
        </div>
        <div class="col-md-4 text-end">
          <div class="display-4">ğŸ‰</div>
        </div>
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="row">
      <div class="col-md-4">
        <div class="stats-card text-center">
          <div class="display-4 mb-2" id="totalReservations">0</div>
          <div class="h5">ç·äºˆç´„æ•°</div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="stats-card text-center" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
          <div class="display-4 mb-2" id="upcomingReservations">0</div>
          <div class="h5">ä»Šå¾Œã®äºˆç´„</div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="stats-card text-center" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
          <div class="display-4 mb-2" id="todayReservations">0</div>
          <div class="h5">ä»Šæ—¥ã®äºˆç´„</div>
        </div>
      </div>
    </div>

        <!-- Quick Actions - Row 1: Core Features -->
    <div class="row mb-4">
      <div class="col-12">
        <h4 class="mb-3">ğŸ“Š ãƒ¡ã‚¤ãƒ³æ©Ÿèƒ½</h4>
      </div>
      <div class="col-md-3 mb-3">
        <a href="reservation.html" class="text-decoration-none">
          <div class="quick-action">
            <div class="h1 mb-3">ğŸ“…</div>
            <h5>æ–°è¦äºˆç´„</h5>
            <p class="text-muted small">æ–°ã—ã„äºˆç´„ã‚’ä½œæˆ</p>
          </div>
        </a>
      </div>
      <div class="col-md-3 mb-3">
        <a href="reservation.html" class="text-decoration-none">
          <div class="quick-action">
            <div class="h1 mb-3">ğŸ“‹</div>
            <h5>äºˆç´„ä¸€è¦§</h5>
            <p class="text-muted small">ã™ã¹ã¦ã®äºˆç´„ã‚’è¡¨ç¤º</p>
          </div>
        </a>
      </div>
      <div class="col-md-3 mb-3">
        <a href="menu.html" class="text-decoration-none">
          <div class="quick-action">
            <div class="h1 mb-3">ğŸ½ï¸</div>
            <h5>ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h5>
            <p class="text-muted small">æ–™ç†ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¦‹ã‚‹</p>
          </div>
        </a>
      </div>
      <div class="col-md-3 mb-3">
        <a href="profile.html" class="text-decoration-none">
          <div class="quick-action">
            <div class="h1 mb-3">ğŸ‘¤</div>
            <h5>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</h5>
            <p class="text-muted small">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±</p>
          </div>
        </a>
      </div>
    </div>

    <!-- Quick Actions - Row 2: Restaurant Info -->
    <div class="row mb-4">
      <div class="col-12">
        <h4 class="mb-3">ğŸ® ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³æƒ…å ±</h4>
      </div>
      <div class="col-md-3 mb-3">
        <a href="gallery.html" class="text-decoration-none">
          <div class="quick-action">
            <div class="h1 mb-3">ğŸ–¼ï¸</div>
            <h5>ã‚®ãƒ£ãƒ©ãƒªãƒ¼</h5>
            <p class="text-muted small">åº—å†…å†™çœŸ</p>
          </div>
        </a>
      </div>
      <div class="col-md-3 mb-3">
        <a href="info.html" class="text-decoration-none">
          <div class="quick-action">
            <div class="h1 mb-3">ğŸ®</div>
            <h5>åº—èˆ—æƒ…å ±</h5>
            <p class="text-muted small">ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³è©³ç´°</p>
          </div>
        </a>
      </div>
      <div class="col-md-3 mb-3">
        <a href="events.html" class="text-decoration-none">
          <div class="quick-action">
            <div class="h1 mb-3">ğŸ‰</div>
            <h5>ã‚¤ãƒ™ãƒ³ãƒˆ</h5>
            <p class="text-muted small">ç‰¹åˆ¥ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±</p>
          </div>
        </a>
      </div>
      <div class="col-md-3 mb-3">
        <a href="private.html" class="text-decoration-none">
          <div class="quick-action">
            <div class="h1 mb-3">ğŸ’¼</div>
            <h5>è²¸åˆ‡ãƒ»å€‹å®¤</h5>
            <p class="text-muted small">ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ€ã‚¤ãƒ‹ãƒ³ã‚°</p>
          </div>
        </a>
      </div>
    </div>

    <!-- Quick Actions - Row 3: Customer Experience -->
    <div class="row mb-4">
      <div class="col-12">
        <h4 class="mb-3">â­ ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒ¼ãƒ“ã‚¹</h4>
      </div>
      <div class="col-md-3 mb-3">
        <a href="reviews.html" class="text-decoration-none">
          <div class="quick-action">
            <div class="h1 mb-3">â­</div>
            <h5>ãŠå®¢æ§˜ã®å£°</h5>
            <p class="text-muted small">ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¦‹ã‚‹</p>
          </div>
        </a>
      </div>
      <div class="col-md-3 mb-3">
        <a href="loyalty.html" class="text-decoration-none">
          <div class="quick-action">
            <div class="h1 mb-3">ğŸ</div>
            <h5>ä¼šå“¡ç‰¹å…¸</h5>
            <p class="text-muted small">ãƒ­ã‚¤ãƒ¤ãƒ«ãƒ†ã‚£ãƒ—ãƒ­ã‚°ãƒ©ãƒ </p>
          </div>
        </a>
      </div>
      <div class="col-md-3 mb-3">
        <a href="contact.html" class="text-decoration-none">
          <div class="quick-action">
            <div class="h1 mb-3">ğŸ“</div>
            <h5>ãŠå•ã„åˆã‚ã›</h5>
            <p class="text-muted small">ã”é€£çµ¡ã¯ã“ã¡ã‚‰</p>
          </div>
        </a>
      </div>
      <div class="col-md-3 mb-3">
        <a href="help.html" class="text-decoration-none">
          <div class="quick-action">
            <div class="h1 mb-3">â“</div>
            <h5>ãƒ˜ãƒ«ãƒ—</h5>
            <p class="text-muted small">ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</p>
          </div>
        </a>
      </div>
    </div>

    <!-- Quick Actions - Row 4: Additional -->
    <div class="row mb-4">
      <div class="col-12">
        <h4 class="mb-3">ğŸ”§ ãã®ä»–</h4>
      </div>
      <div class="col-md-3 mb-3">
        <a href="careers.html" class="text-decoration-none">
          <div class="quick-action">
            <div class="h1 mb-3">ğŸ’¼</div>
            <h5>æ¡ç”¨æƒ…å ±</h5>
            <p class="text-muted small">ã‚­ãƒ£ãƒªã‚¢ opportunities</p>
          </div>
        </a>
      </div>
      <div class="col-md-3 mb-3">
        <div class="quick-action" style="cursor: not-allowed; opacity: 0.6;">
          <div class="h1 mb-3">ğŸ“±</div>
          <h5>ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒª</h5>
          <p class="text-muted small">è¿‘æ—¥å…¬é–‹</p>
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <div class="quick-action" style="cursor: not-allowed; opacity: 0.6;">
          <div class="h1 mb-3">ğŸ«</div>
          <h5>ã‚®ãƒ•ãƒˆã‚«ãƒ¼ãƒ‰</h5>
          <p class="text-muted small">è¿‘æ—¥å…¬é–‹</p>
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <div class="quick-action" style="cursor: not-allowed; opacity: 0.6;">
          <div class="h1 mb-3">ğŸšš</div>
          <h5>ã‚±ãƒ¼ã‚¿ãƒªãƒ³ã‚°</h5>
          <p class="text-muted small">è¿‘æ—¥å…¬é–‹</p>
        </div>
      </div>
    </div>

<!-- Additional Actions -->
<div class="row mb-4">
  <div class="col-md-3 mb-3">
    <a href="menu.html" class="text-decoration-none">
      <div class="quick-action">
        <div class="h1 mb-3">ğŸ½ï¸</div>
        <h5>ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h5>
        <p class="text-muted small">æ–™ç†ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¦‹ã‚‹</p>
      </div>
    </a>
  </div>
  <div class="col-md-3 mb-3">
    <a href="info.html" class="text-decoration-none">
      <div class="quick-action">
        <div class="h1 mb-3">ğŸ®</div>
        <h5>åº—èˆ—æƒ…å ±</h5>
        <p class="text-muted small">ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³è©³ç´°</p>
      </div>
    </a>
  </div>
  <div class="col-md-3 mb-3">
    <a href="gallery.html" class="text-decoration-none">
      <div class="quick-action">
        <div class="h1 mb-3">ğŸ–¼ï¸</div>
        <h5>ã‚®ãƒ£ãƒ©ãƒªãƒ¼</h5>
        <p class="text-muted small">åº—å†…å†™çœŸ</p>
      </div>
    </a>
  </div>
  <div class="col-md-3 mb-3">
    <a href="contact.html" class="text-decoration-none">
      <div class="quick-action">
        <div class="h1 mb-3">ğŸ“</div>
        <h5>ãŠå•ã„åˆã‚ã›</h5>
        <p class="text-muted small">ã”é€£çµ¡ã¯ã“ã¡ã‚‰</p>
      </div>
    </a>
  </div>
  <!-- In the "ãã®ä»–" section of dashboard.html -->
<div class="row mb-4">
  <div class="col-12">
    <h4 class="mb-3">ğŸ”§ ãã®ä»–</h4>
  </div>
  <div class="col-md-3 mb-3">
    <a href="careers.html" class="text-decoration-none">
      <div class="quick-action">
        <div class="h1 mb-3">ğŸ’¼</div>
        <h5>æ¡ç”¨æƒ…å ±</h5>
        <p class="text-muted small">ã‚­ãƒ£ãƒªã‚¢ opportunities</p>
      </div>
    </a>
  </div>
  <div class="col-md-3 mb-3">
    <a href="app.html" class="text-decoration-none">
      <div class="quick-action">
        <div class="h1 mb-3">ğŸ“±</div>
        <h5>ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒª</h5>
        <p class="text-muted small">ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</p>
      </div>
    </a>
  </div>
  <div class="col-md-3 mb-3">
    <a href="giftcards.html" class="text-decoration-none">
      <div class="quick-action">
        <div class="h1 mb-3">ğŸ«</div>
        <h5>ã‚®ãƒ•ãƒˆã‚«ãƒ¼ãƒ‰</h5>
        <p class="text-muted small">è³¼å…¥ãƒ»è´ˆç­”</p>
      </div>
    </a>
  </div>
  <div class="col-md-3 mb-3">
    <a href="catering.html" class="text-decoration-none">
      <div class="quick-action">
        <div class="h1 mb-3">ğŸšš</div>
        <h5>ã‚±ãƒ¼ã‚¿ãƒªãƒ³ã‚°</h5>
        <p class="text-muted small">å‡ºå¼µæ–™ç†ã‚µãƒ¼ãƒ“ã‚¹</p>
      </div>
    </a>
  </div>
</div>
</div>
    </a>
  </div>
</div>
    <!-- Recent Reservations -->
    <div class="recent-reservations">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h4>æœ€è¿‘ã®äºˆç´„</h4>
        <a href="reservation.html" class="btn btn-japanese btn-sm">ã™ã¹ã¦è¡¨ç¤º</a>
      </div>
      <div id="recentReservationsList">
        <div class="text-center py-4">
          <div class="text-muted">äºˆç´„ãŒã‚ã‚Šã¾ã›ã‚“</div>
          <a href="reservation.html" class="btn btn-japanese mt-2">æœ€åˆã®äºˆç´„ã‚’ä½œæˆ</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Profile Modal -->
  <div class="modal fade" id="profileModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <strong>åå‰:</strong> <span id="profileName">-</span>
          </div>
          <div class="mb-3">
            <strong>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹:</strong> <span id="profileEmail">-</span>
          </div>
          <div class="mb-3">
            <strong>ç™»éŒ²æ—¥:</strong> <span id="profileCreatedAt">-</span>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">é–‰ã˜ã‚‹</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
   
const currentUser = JSON.parse(localStorage.getItem('user'));
if (!currentUser) {
  alert('ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™');
  window.location.href = 'login.html';
}

    // Supabase configuration
    const SUPABASE_URL = 'https://nfcjbjohxzaikelxgmjg.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5mY2piam9oeHphaWtlbHhnbWpnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEwNTgzMjAsImV4cCI6MjA3NjYzNDMyMH0.u0ta1NxSDbJ_9lf1TcMp3M0-_vNNBs6HByOj8wtKsX4';
    
    // Initialize Supabase
    const { createClient } = supabase;
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    console.log('Dashboard loaded for user:', user);

    // Update welcome message
    document.getElementById('userWelcome').textContent = `ã‚ˆã†ã“ãã€${user.name}ã•ã‚“ï¼`;
    document.getElementById('welcomeMessage').textContent = `ã‚ˆã†ã“ãã€${user.name}ã•ã‚“ï¼`;
    
    // Set profile information
    document.getElementById('profileName').textContent = user.name;
    document.getElementById('profileEmail').textContent = user.email;
    if (user.created_at) {
      document.getElementById('profileCreatedAt').textContent = new Date(user.created_at).toLocaleDateString('ja-JP');
    } else {
      document.getElementById('profileCreatedAt').textContent = 'ä»Šæ—¥';
    }

    // Load dashboard data
    async function loadDashboardData() {
      try {
        console.log('Loading reservations for user:', user.id);
        
        // Load user's reservations
        const { data: reservations, error } = await supabaseClient
          .from('reservations')
          .select('*')
          .eq('user_id', user.id)
          .order('created_at', { ascending: false });

        if (error) {
          console.error('Supabase error:', error);
          throw error;
        }

        console.log('Reservations loaded:', reservations);

        // Update stats
        const total = reservations ? reservations.length : 0;
        document.getElementById('totalReservations').textContent = total;
        
        const today = new Date().toISOString().split('T')[0];
        const upcoming = reservations ? reservations.filter(r => r.date >= today).length : 0;
        const todayCount = reservations ? reservations.filter(r => r.date === today).length : 0;
        
        document.getElementById('upcomingReservations').textContent = upcoming;
        document.getElementById('todayReservations').textContent = todayCount;

        // Show recent reservations (last 3)
        if (reservations && reservations.length > 0) {
          const recentReservations = reservations.slice(0, 3);
          displayRecentReservations(recentReservations);
        }

      } catch (error) {
        console.error('Error loading dashboard data:', error);
        // Show error but don't break the page
        document.getElementById('recentReservationsList').innerHTML = `
          <div class="alert alert-warning">
            ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ
          </div>
        `;
      }
    }

    function displayRecentReservations(reservations) {
      const container = document.getElementById('recentReservationsList');
      
      let html = '';
      reservations.forEach(reservation => {
        const reservationDate = new Date(reservation.date + 'T' + reservation.time).toLocaleDateString('ja-JP', {
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });
        
        html += `
          <div class="reservation-item border-bottom pb-3 mb-3">
            <div class="row align-items-center">
              <div class="col-md-4">
                <strong>${reservation.customer_name}</strong>
              </div>
              <div class="col-md-3">
                ${reservationDate}
              </div>
              <div class="col-md-2">
                ${reservation.time}
              </div>
              <div class="col-md-2">
                ${reservation.guests}äºº
              </div>
              <div class="col-md-1">
                <span class="badge bg-success">ç¢ºèªæ¸ˆã¿</span>
              </div>
            </div>
          </div>
        `;
      });

      container.innerHTML = html;
    }

    // Logout function
    document.getElementById('logoutBtn').addEventListener('click', () => {
      if (confirm('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
        localStorage.removeItem('user');
        window.location.href = 'index.html';
      }
    });

    // Help function
    function showHelp() {
      alert('ãŠå•ã„åˆã‚ã›: support@restaurant.com\né›»è©±: 0120-123-456\n\nä½¿ã„æ–¹:\n1. ã€Œæ–°è¦äºˆç´„ã€ã§äºˆç´„ã‚’ä½œæˆ\n2. ã€Œäºˆç´„ä¸€è¦§ã€ã§ç®¡ç†\n3. ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã§æƒ…å ±ç¢ºèª');
    }

    // Load data when page loads
    document.addEventListener('DOMContentLoaded', function() {
      loadDashboardData();
    });
  </script>
</body>
</html>