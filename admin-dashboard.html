<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ - ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³äºˆç´„ã‚·ã‚¹ãƒ†ãƒ </title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    .admin-sidebar {
      background: #2c3e50;
      color: white;
      min-height: 100vh;
      padding: 0;
      position: fixed;
      width: 250px;
      z-index: 1000;
    }
    .admin-sidebar .nav-link {
      color: #ecf0f1;
      padding: 1rem 1.5rem;
      border-bottom: 1px solid #34495e;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
    }
    .admin-sidebar .nav-link i {
      width: 20px;
      margin-right: 10px;
    }
    .admin-sidebar .nav-link:hover,
    .admin-sidebar .nav-link.active {
      background: #34495e;
      color: #3498db;
    }
    .admin-main {
      background: #f8f9fa;
      min-height: 100vh;
      margin-left: 250px;
    }
    .admin-card {
      border: none;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      transition: transform 0.3s ease;
      margin-bottom: 1.5rem;
    }
    .admin-card:hover {
      transform: translateY(-5px);
    }
    .stat-card {
      text-align: center;
      padding: 1.5rem;
      color: white;
    }
    .stat-number {
      font-size: 2.5rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
    }
    .recent-activity {
      max-height: 400px;
      overflow-y: auto;
    }
    .activity-item {
      padding: 0.75rem;
      border-bottom: 1px solid #eee;
      display: flex;
      align-items: center;
    }
    .activity-item:last-child {
      border-bottom: none;
    }
    .activity-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 1rem;
      font-size: 1.2rem;
    }
    .table-actions {
      display: flex;
      gap: 0.5rem;
    }
    .btn-sm {
      padding: 0.25rem 0.5rem;
      font-size: 0.875rem;
    }
    .chart-container {
      position: relative;
      height: 300px;
      margin: 1rem 0;
    }
    .badge-status {
      font-size: 0.75rem;
    }
    .search-box {
      max-width: 300px;
    }
    .pagination {
      margin-bottom: 0;
    }
    .table-image {
      width: 50px;
      height: 50px;
      border-radius: 8px;
      object-fit: cover;
    }
    .menu-image {
      width: 60px;
      height: 60px;
      border-radius: 10px;
      object-fit: cover;
    }
    .staff-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
    }
    .customer-avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      object-fit: cover;
    }
    .table-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }
    .table-card {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      text-align: center;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      border: 2px solid transparent;
      transition: all 0.3s ease;
    }
    .table-card.occupied {
      border-color: #e74c3c;
      background: #fff5f5;
    }
    .table-card.available {
      border-color: #27ae60;
      background: #f8fff8;
    }
    .table-card.reserved {
      border-color: #f39c12;
      background: #fffaf0;
    }
    .review-card {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      border-left: 4px solid #3498db;
    }
    .review-header {
      display: flex;
      align-items: center;
      margin-bottom: 1rem;
    }
    .review-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      margin-right: 1rem;
      object-fit: cover;
    }
    .rating-stars {
      color: #ffc107;
    }
  </style>
</head>
<body>
  <!-- Admin Navigation -->
  <nav class="navbar navbar-dark sticky-top" style="background-color: #c62828; height: 70px;">
    <div class="container-fluid">
      <a class="navbar-brand fw-bold" href="admin-dashboard.html">
        <i class="fas fa-crown me-2"></i>ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
      </a>
      <div class="navbar-nav ms-auto flex-row align-items-center">
        <span class="navbar-text me-3" id="adminWelcome">
          <i class="fas fa-user me-1"></i>ç®¡ç†è€…
        </span>
        <div class="dropdown me-2">
          <button class="btn btn-outline-light btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
            <i class="fas fa-cog me-1"></i>è¨­å®š
          </button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#" onclick="showProfileModal()"><i class="fas fa-user me-2"></i>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</a></li>
            <li><a class="dropdown-item" href="#"><i class="fas fa-bell me-2"></i>é€šçŸ¥è¨­å®š</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="#" onclick="refreshDashboard()"><i class="fas fa-sync-alt me-2"></i>æ›´æ–°</a></li>
          </ul>
        </div>
        <button class="btn btn-outline-light btn-sm" id="adminLogoutBtn">
          <i class="fas fa-sign-out-alt me-1"></i>ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
        </button>
      </div>
    </div>
  </nav>

  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar -->
      <div class="col-md-2 admin-sidebar">
        <div class="d-flex flex-column flex-shrink-0 p-3">
          <div class="text-center mb-4 mt-2">
            <img src="https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=80&h=80&fit=crop&crop=center" class="rounded-circle mb-2" alt="Restaurant" style="width: 60px; height: 60px; object-fit: cover;">
            <h5 class="text-white">å’Œé£Ÿãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ æ¡œ</h5>
            <small class="text-muted">ç®¡ç†è€…ãƒ‘ãƒãƒ« v2.1</small>
          </div>
          <ul class="nav nav-pills flex-column mb-auto">
            <li class="nav-item">
              <a href="#dashboard" class="nav-link active" onclick="showSection('dashboard')">
                <i class="fas fa-chart-line"></i>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
              </a>
            </li>
            <li class="nav-item">
              <a href="#reservations" class="nav-link" onclick="showSection('reservations')">
                <i class="fas fa-calendar-alt"></i>äºˆç´„ç®¡ç†
              </a>
            </li>
            <li class="nav-item">
              <a href="#customers" class="nav-link" onclick="showSection('customers')">
                <i class="fas fa-users"></i>é¡§å®¢ç®¡ç†
              </a>
            </li>
            <li class="nav-item">
              <a href="#staff" class="nav-link" onclick="showSection('staff')">
                <i class="fas fa-user-tie"></i>ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†
              </a>
            </li>
            <li class="nav-item">
              <a href="#menu" class="nav-link" onclick="showSection('menu')">
                <i class="fas fa-utensils"></i>ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†
              </a>
            </li>
            <li class="nav-item">
              <a href="#tables" class="nav-link" onclick="showSection('tables')">
                <i class="fas fa-chair"></i>å¸­ç®¡ç†
              </a>
            </li>
            <li class="nav-item">
              <a href="#reports" class="nav-link" onclick="showSection('reports')">
                <i class="fas fa-chart-bar"></i>åˆ†æãƒ¬ãƒãƒ¼ãƒˆ
              </a>
            </li>
            <li class="nav-item">
              <a href="#reviews" class="nav-link" onclick="showSection('reviews')">
                <i class="fas fa-star"></i>ãƒ¬ãƒ“ãƒ¥ãƒ¼ç®¡ç†
              </a>
            </li>
            <li class="nav-item">
              <a href="#settings" class="nav-link" onclick="showSection('settings')">
                <i class="fas fa-cogs"></i>ã‚·ã‚¹ãƒ†ãƒ è¨­å®š
              </a>
            </li>
            <li class="nav-item">
              <a href="#admin-management" class="nav-link" onclick="showSection('admin-management')">
                <i class="fas fa-user-shield"></i>ç®¡ç†è€…ç®¡ç†
              </a>
            </li>
          </ul>
          <div class="mt-auto pt-3">
            <div class="text-center text-muted small">
              <div id="currentDateTime"></div>
              <div id="networkStatus" class="badge bg-success mt-1">ğŸŸ¢ ã‚ªãƒ³ãƒ©ã‚¤ãƒ³</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="col-md-10 admin-main p-4">
        
        <!-- Dashboard Section -->
        <div id="dashboard-section" class="section-content">
          <!-- Dashboard content remains the same as before -->
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h3><i class="fas fa-chart-line me-2"></i>çµŒå–¶ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h3>
            <div class="btn-group">
              <button class="btn btn-outline-primary btn-sm" onclick="loadStats('today')">ä»Šæ—¥</button>
              <button class="btn btn-outline-primary btn-sm" onclick="loadStats('week')">ä»Šé€±</button>
              <button class="btn btn-outline-primary btn-sm active" onclick="loadStats('month')">ä»Šæœˆ</button>
            </div>
          </div>

          <!-- Stats Cards -->
          <div class="row mb-4">
            <div class="col-xl-3 col-md-6 mb-3">
              <div class="card admin-card stat-card" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                <div class="stat-number" id="totalReservations">156</div>
                <div>ç·äºˆç´„æ•°</div>
                <small><i class="fas fa-arrow-up me-1"></i><span id="reservationTrend">12%</span> å‰æœˆæ¯”</small>
              </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-3">
              <div class="card admin-card stat-card" style="background: linear-gradient(135deg, #f093fb, #f5576c);">
                <div class="stat-number" id="todayRevenue">Â¥458,000</div>
                <div>å£²ä¸Š</div>
                <small><i class="fas fa-arrow-up me-1"></i><span id="revenueTrend">8%</span> å‰æœˆæ¯”</small>
              </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-3">
              <div class="card admin-card stat-card" style="background: linear-gradient(135deg, #4facfe, #00f2fe);">
                <div class="stat-number" id="activeStaff">8</div>
                <div>å‡ºå‹¤ã‚¹ã‚¿ãƒƒãƒ•</div>
                <small><i class="fas fa-user-clock me-1"></i>æœ¬æ—¥</small>
              </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-3">
              <div class="card admin-card stat-card" style="background: linear-gradient(135deg, #43e97b, #38f9d7);">
                <div class="stat-number" id="tableOccupancy">78%</div>
                <div>å¸­ç¨¼åƒç‡</div>
                <small><i class="fas fa-chart-line me-1"></i>ãƒ”ãƒ¼ã‚¯æ™‚</small>
              </div>
            </div>
          </div>

          <!-- Rest of dashboard content... -->
        </div>

        <!-- Staff Management Section -->
        <div id="staff-section" class="section-content d-none">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h3><i class="fas fa-user-tie me-2"></i>ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†</h3>
            <div>
              <button class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#addStaffModal">
                <i class="fas fa-plus me-1"></i>ã‚¹ã‚¿ãƒƒãƒ•è¿½åŠ 
              </button>
              <button class="btn btn-outline-secondary" onclick="loadStaffList()">
                <i class="fas fa-sync-alt me-1"></i>æ›´æ–°
              </button>
            </div>
          </div>

          <div class="card admin-card">
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>ã‚¹ã‚¿ãƒƒãƒ•ID</th>
                      <th>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</th>
                      <th>æ°å</th>
                      <th>å½¹è·</th>
                      <th>ãƒ¡ãƒ¼ãƒ«</th>
                      <th>é›»è©±ç•ªå·</th>
                      <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                      <th>æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³</th>
                      <th>æ“ä½œ</th>
                    </tr>
                  </thead>
                  <tbody id="staffTable">
                    <!-- Staff will be loaded here -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Menu Management Section -->
        <div id="menu-section" class="section-content d-none">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h3><i class="fas fa-utensils me-2"></i>ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†</h3>
            <div>
              <button class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#addMenuItemModal">
                <i class="fas fa-plus me-1"></i>ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¿½åŠ 
              </button>
              <button class="btn btn-outline-secondary" onclick="loadMenuItems()">
                <i class="fas fa-sync-alt me-1"></i>æ›´æ–°
              </button>
            </div>
          </div>

          <div class="card admin-card">
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>ãƒ¡ãƒ‹ãƒ¥ãƒ¼ID</th>
                      <th>ç”»åƒ</th>
                      <th>åå‰</th>
                      <th>ã‚«ãƒ†ã‚´ãƒªãƒ¼</th>
                      <th>ä¾¡æ ¼</th>
                      <th>åœ¨åº«</th>
                      <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                      <th>äººæ°—åº¦</th>
                      <th>æ“ä½œ</th>
                    </tr>
                  </thead>
                  <tbody id="menuTable">
                    <!-- Menu items will be loaded here -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Tables Management Section -->
        <div id="tables-section" class="section-content d-none">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h3><i class="fas fa-chair me-2"></i>å¸­ç®¡ç†</h3>
            <div>
              <button class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#addTableModal">
                <i class="fas fa-plus me-1"></i>å¸­è¿½åŠ 
              </button>
              <button class="btn btn-outline-secondary" onclick="loadTables()">
                <i class="fas fa-sync-alt me-1"></i>æ›´æ–°
              </button>
            </div>
          </div>

          <div class="table-grid" id="tablesGrid">
            <!-- Tables will be loaded here as cards -->
          </div>
        </div>

        <!-- Add other sections (reservations, customers, reports, reviews, settings, admin-management) similarly -->

      </div>
    </div>
  </div>

  <!-- Add Staff Modal -->
  <div class="modal fade" id="addStaffModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"><i class="fas fa-user-plus me-2"></i>ã‚¹ã‚¿ãƒƒãƒ•è¿½åŠ </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="addStaffForm">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">ğŸ‘¤ æ°å *</label>
                <input type="text" class="form-control" id="staffName" required>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">ğŸ·ï¸ å½¹è· *</label>
                <select class="form-select" id="staffRole" required>
                  <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                  <option value="ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼">ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼</option>
                  <option value="ã‚·ã‚§ãƒ•">ã‚·ã‚§ãƒ•</option>
                  <option value="ãƒ›ãƒ¼ãƒ«ã‚¹ã‚¿ãƒƒãƒ•">ãƒ›ãƒ¼ãƒ«ã‚¹ã‚¿ãƒƒãƒ•</option>
                  <option value="ã‚­ãƒƒãƒãƒ³ã‚¹ã‚¿ãƒƒãƒ•">ã‚­ãƒƒãƒãƒ³ã‚¹ã‚¿ãƒƒãƒ•</option>
                </select>
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">ğŸ“§ ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                <input type="email" class="form-control" id="staffEmail">
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">ğŸ“ é›»è©±ç•ªå·</label>
                <input type="tel" class="form-control" id="staffPhone">
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">ğŸ”‘ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ *</label>
                <input type="password" class="form-control" id="staffPassword" required minlength="6">
                <small class="text-muted">æœ€ä½6æ–‡å­—ä»¥ä¸Š</small>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">ğŸ†” ã‚¹ã‚¿ãƒƒãƒ•ã‚³ãƒ¼ãƒ‰</label>
                <input type="text" class="form-control" id="staffCode" readonly>
                <small class="text-muted">è‡ªå‹•ç”Ÿæˆ</small>
              </div>
            </div>
            
            <div class="form-check mb-3">
              <input class="form-check-input" type="checkbox" id="staffActive" checked>
              <label class="form-check-label">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–</label>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
          <button type="button" class="btn btn-primary" onclick="registerStaff()">
            <i class="fas fa-save me-1"></i>ã‚¹ã‚¿ãƒƒãƒ•ã‚’ç™»éŒ²
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Menu Item Modal -->
  <div class="modal fade" id="addMenuItemModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"><i class="fas fa-utensils me-2"></i>ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¿½åŠ </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="addMenuForm">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">ğŸ½ï¸ ãƒ¡ãƒ‹ãƒ¥ãƒ¼å *</label>
                <input type="text" class="form-control" id="menuName" required>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">ğŸ“ ã‚«ãƒ†ã‚´ãƒªãƒ¼ *</label>
                <select class="form-select" id="menuCategory" required>
                  <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                  <option value="å‰èœ">å‰èœ</option>
                  <option value="ãƒ¡ã‚¤ãƒ³">ãƒ¡ã‚¤ãƒ³</option>
                  <option value="ãƒ‡ã‚¶ãƒ¼ãƒˆ">ãƒ‡ã‚¶ãƒ¼ãƒˆ</option>
                  <option value="ãƒ‰ãƒªãƒ³ã‚¯">ãƒ‰ãƒªãƒ³ã‚¯</option>
                </select>
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">ğŸ’° ä¾¡æ ¼ *</label>
                <input type="number" class="form-control" id="menuPrice" required min="0">
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">ğŸ“· ç”»åƒ</label>
                <input type="file" class="form-control" id="menuImage" accept="image/*">
              </div>
            </div>
            
            <div class="mb-3">
              <label class="form-label">ğŸ“ èª¬æ˜</label>
              <textarea class="form-control" id="menuDescription" rows="3"></textarea>
            </div>
            
            <div class="form-check mb-3">
              <input class="form-check-input" type="checkbox" id="menuAvailable" checked>
              <label class="form-check-label">æä¾›ä¸­</label>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
          <button type="button" class="btn btn-primary" onclick="registerMenuItem()">
            <i class="fas fa-save me-1"></i>ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ 
          </button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    // Supabase client
    const supabase = window.supabase.createClient(
      'https://nfcjbjohxzaikelxgmjg.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5mY2piam9oeHphaWtlbHhnbWpnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEwNTgzMjAsImV4cCI6MjA3NjYzNDMyMH0.u0ta1NxSDbJ_9lf1TcMp3M0-_vNNBs6HByOj8wtKsX4'
    );

    // Check admin authentication
    const adminUser = JSON.parse(localStorage.getItem('adminUser'));
    if (!adminUser) {
      alert('ç®¡ç†è€…æ¨©é™ãŒå¿…è¦ã§ã™');
      window.location.href = 'admin-login.html';
    }

    // Update welcome message and datetime
    document.getElementById('adminWelcome').textContent = `ã‚ˆã†ã“ãã€${adminUser.username}ã•ã‚“`;
    function updateDateTime() {
      const now = new Date();
      document.getElementById('currentDateTime').textContent = 
        now.toLocaleDateString('ja-JP') + ' ' + now.toLocaleTimeString('ja-JP');
    }
    setInterval(updateDateTime, 1000);
    updateDateTime();

    // Section navigation
    function showSection(sectionName) {
      document.querySelectorAll('.section-content').forEach(section => {
        section.classList.add('d-none');
      });
      
      document.getElementById(`${sectionName}-section`).classList.remove('d-none');
      
      document.querySelectorAll('.admin-sidebar .nav-link').forEach(link => {
        link.classList.remove('active');
      });
      event.target.classList.add('active');

      switch(sectionName) {
        case 'dashboard':
          loadDashboardData();
          break;
        case 'reservations':
          loadReservations();
          break;
        case 'customers':
          loadCustomers();
          break;
        case 'staff':
          loadStaffList();
          break;
        case 'menu':
          loadMenuItems();
          break;
        case 'tables':
          loadTables();
          break;
        case 'reports':
          loadReports();
          break;
        case 'reviews':
          loadReviews();
          break;
        case 'settings':
          loadSettings();
          break;
        case 'admin-management':
          loadAdminList();
          break;
      }
    }

    // Staff Management Functions
    function generateStaffCode() {
      const prefix = 'STAFF';
      const random = Math.floor(1000 + Math.random() * 9000);
      return `${prefix}${random}`;
    }

    document.getElementById('addStaffModal').addEventListener('show.bs.modal', function() {
      document.getElementById('staffCode').value = generateStaffCode();
    });

    async function registerStaff() {
      const staffData = {
        name: document.getElementById('staffName').value,
        role: document.getElementById('staffRole').value,
        email: document.getElementById('staffEmail').value,
        phone: document.getElementById('staffPhone').value,
        staff_code: document.getElementById('staffCode').value,
        password: document.getElementById('staffPassword').value,
        is_active: document.getElementById('staffActive').checked
      };

      if (!staffData.name || !staffData.role || !staffData.password) {
        showNotification('å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
        return;
      }

      try {
        const { data, error } = await supabase
          .from('staff')
          .insert([staffData]);

        if (error) throw error;

        bootstrap.Modal.getInstance(document.getElementById('addStaffModal')).hide();
        document.getElementById('addStaffForm').reset();
        
        loadStaffList();
        showNotification(`âœ… ã‚¹ã‚¿ãƒƒãƒ•ã€Œ${staffData.name}ã€ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼`, 'success');
        
      } catch (error) {
        showNotification(`âŒ ã‚¹ã‚¿ãƒƒãƒ•ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`, 'error');
      }
    }

    async function loadStaffList() {
      try {
        const { data: staff, error } = await supabase
          .from('staff')
          .select('*')
          .order('created_at', { ascending: false });

        if (error) throw error;

        const staffTable = document.getElementById('staffTable');
        
        if (!staff || staff.length === 0) {
          staffTable.innerHTML = `
            <tr>
              <td colspan="9" class="text-center py-4 text-muted">
                <i class="fas fa-users fa-2x mb-3 d-block"></i>
                ã‚¹ã‚¿ãƒƒãƒ•ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“
              </td>
            </tr>
          `;
          return;
        }

        staffTable.innerHTML = staff.map(person => `
          <tr>
            <td><strong>${person.staff_code}</strong></td>
            <td>
              <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop&crop=face" 
                   class="staff-avatar" alt="${person.name}">
            </td>
            <td>${person.name}</td>
            <td>${person.role}</td>
            <td>${person.email || '-'}</td>
            <td>${person.phone || '-'}</td>
            <td>
              <span class="badge ${person.is_active ? 'bg-success' : 'bg-secondary'}">
                ${person.is_active ? 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–' : 'éã‚¢ã‚¯ãƒ†ã‚£ãƒ–'}
              </span>
            </td>
            <td>${person.last_login ? new Date(person.last_login).toLocaleDateString('ja-JP') : 'æœªãƒ­ã‚°ã‚¤ãƒ³'}</td>
            <td>
              <div class="table-actions">
                <button class="btn btn-sm btn-outline-primary" title="ç·¨é›†">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-sm btn-outline-danger" onclick="deleteStaff(${person.id})" title="å‰Šé™¤">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        `).join('');

      } catch (error) {
        console.error('Error loading staff:', error);
        showNotification('ã‚¹ã‚¿ãƒƒãƒ•ãƒªã‚¹ãƒˆã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
      }
    }

    async function deleteStaff(staffId) {
      if (!confirm('ã“ã®ã‚¹ã‚¿ãƒƒãƒ•ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚')) {
        return;
      }

      try {
        const { error } = await supabase
          .from('staff')
          .delete()
          .eq('id', staffId);

        if (error) throw error;

        loadStaffList();
        showNotification('âœ… ã‚¹ã‚¿ãƒƒãƒ•ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'success');
        
      } catch (error) {
        console.error('Error deleting staff:', error);
        showNotification('âŒ å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
      }
    }

    // Menu Management Functions
    async function registerMenuItem() {
      const menuData = {
        name: document.getElementById('menuName').value,
        category: document.getElementById('menuCategory').value,
        price: document.getElementById('menuPrice').value,
        description: document.getElementById('menuDescription').value,
        is_available: document.getElementById('menuAvailable').checked
      };

      if (!menuData.name || !menuData.category || !menuData.price) {
        showNotification('å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
        return;
      }

      try {
        const { data, error } = await supabase
          .from('menu_items')
          .insert([menuData]);

        if (error) throw error;

        bootstrap.Modal.getInstance(document.getElementById('addMenuItemModal')).hide();
        document.getElementById('addMenuForm').reset();
        
        loadMenuItems();
        showNotification(`âœ… ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€Œ${menuData.name}ã€ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼`, 'success');
        
      } catch (error) {
        showNotification(`âŒ ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`, 'error');
      }
    }

    async function loadMenuItems() {
      // For demo purposes, we'll create sample data
      const sampleMenu = [
        { 
          id: 1, 
          name: 'å’Œç‰›ã‚¹ãƒ†ãƒ¼ã‚­', 
          category: 'ãƒ¡ã‚¤ãƒ³', 
          price: 4500, 
          is_available: true, 
          image: 'https://images.unsplash.com/photo-1546833999-b9f581a1996d?w=100&h=100&fit=crop',
          popularity: 4.8
        },
        { 
          id: 2, 
          name: 'åˆºèº«ç››ã‚Šåˆã‚ã›', 
          category: 'å‰èœ', 
          price: 2800, 
          is_available: true, 
          image: 'https://images.unsplash.com/photo-1579584425555-c3ce17fd4351?w=100&h=100&fit=crop',
          popularity: 4.5
        },
        { 
          id: 3, 
          name: 'æŠ¹èŒ¶ãƒ†ã‚£ãƒ©ãƒŸã‚¹', 
          category: 'ãƒ‡ã‚¶ãƒ¼ãƒˆ', 
          price: 1200, 
          is_available: true, 
          image: 'https://images.unsplash.com/photo-1565958011703-44f9829ba187?w=100&h=100&fit=crop',
          popularity: 4.9
        }
      ];

      const menuTable = document.getElementById('menuTable');
      menuTable.innerHTML = sampleMenu.map(item => `
        <tr>
          <td>#MENU${item.id}</td>
          <td>
            <img src="${item.image}" class="menu-image" alt="${item.name}">
          </td>
          <td>${item.name}</td>
          <td>${item.category}</td>
          <td>Â¥${item.price.toLocaleString()}</td>
          <td>åœ¨åº«ã‚ã‚Š</td>
          <td>
            <span class="badge ${item.is_available ? 'bg-success' : 'bg-secondary'}">
              ${item.is_available ? 'æä¾›ä¸­' : 'åœæ­¢ä¸­'}
            </span>
          </td>
          <td>${item.popularity} â­</td>
          <td>
            <div class="table-actions">
              <button class="btn btn-sm btn-outline-primary" title="ç·¨é›†">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-sm btn-outline-danger" title="å‰Šé™¤">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    // Tables Management
    async function loadTables() {
      const sampleTables = [
        { id: 1, number: 'T01', capacity: 4, status: 'available', type: 'çª“å´' },
        { id: 2, number: 'T02', capacity: 2, status: 'occupied', type: 'ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼' },
        { id: 3, number: 'T03', capacity: 6, status: 'reserved', type: 'å€‹å®¤' },
        { id: 4, number: 'T04', capacity: 4, status: 'available', type: 'ä¸­å¤®' },
        { id: 5, number: 'T05', capacity: 8, status: 'available', type: 'å®´ä¼š' },
        { id: 6, number: 'T06', capacity: 2, status: 'occupied', type: 'çª“å´' }
      ];

      const tablesGrid = document.getElementById('tablesGrid');
      tablesGrid.innerHTML = sampleTables.map(table => `
        <div class="table-card ${table.status}">
          <h5>${table.number}</h5>
          <div class="h4 mb-2">${table.capacity}å</div>
          <div class="mb-2">
            <span class="badge ${
              table.status === 'available' ? 'bg-success' : 
              table.status === 'occupied' ? 'bg-danger' : 'bg-warning'
            }">
              ${
                table.status === 'available' ? 'ç©ºå¸­' : 
                table.status === 'occupied' ? 'åˆ©ç”¨ä¸­' : 'äºˆç´„æ¸ˆã¿'
              }
            </span>
          </div>
          <small class="text-muted">${table.type}</small>
        </div>
      `).join('');
    }

    // Utility functions
    function showNotification(message, type = 'info') {
      const toast = document.createElement('div');
      toast.className = `toast align-items-center text-white bg-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'} border-0`;
      toast.innerHTML = `
        <div class="d-flex">
          <div class="toast-body">${message}</div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
      `;
      
      const container = document.createElement('div');
      container.className = 'toast-container position-fixed top-0 end-0 p-3';
      container.style.zIndex = '9999';
      container.appendChild(toast);
      document.body.appendChild(container);
      
      const bsToast = new bootstrap.Toast(toast);
      bsToast.show();
      
      toast.addEventListener('hidden.bs.toast', () => {
        container.remove();
      });
    }

    function refreshDashboard() {
      showNotification('ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’æ›´æ–°ã—ã¾ã—ãŸ', 'success');
    }

    // Logout
    document.getElementById('adminLogoutBtn').addEventListener('click', () => {
      if (confirm('ç®¡ç†è€…ã‹ã‚‰ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
        localStorage.removeItem('adminUser');
        window.location.href = 'admin-login.html';
      }
    });

    // Initialize
    loadStaffList();
    loadMenuItems();
    loadTables();
  </script>
</body>
</html>